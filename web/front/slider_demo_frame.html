
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Plotly Slider Points</title>
  <script src='https://cdn.plot.ly/plotly-3.3.0.min.js'></script>
  <style>
    body { font-family: system-ui, sans-serif; margin: 0; padding: 20px; }
  </style>
</head>
<body>
  <div id="chart" style="width: 100%; height: 600px;"></div>

  <script>
    // --- Paramètres ---
    const N = 40;           // nombre de points
    const T = 20;           // nombre d'étapes "temps" (frames)
    const spread = 10;      // étendue initiale des points

    // Génère une population de points initiale
    function initPoints(n, spread = 10) {
      const x = [], y = [];
      for (let i = 0; i < n; i++) {
        x.push((Math.random() - 0.5) * spread);
        y.push((Math.random() - 0.5) * spread);
      }
      return { x, y };
    }

    // Fait évoluer les points légèrement à chaque frame (random walk)
    function stepPoints(prev, stepSize = 0.7) {
      const x = [], y = [];
      for (let i = 0; i < prev.x.length; i++) {
        x.push(prev.x[i] + (Math.random() - 0.5) * stepSize);
        y.push(prev.y[i] + (Math.random() - 0.5) * stepSize);
      }
      return { x, y };
    }

    // Crée les frames Plotly pour T étapes
    function makeFrames(initial, T) {
      const frames = [];
      let cur = initial;
      for (let t = 0; t < T; t++) {
        // fait évoluer
        cur = stepPoints(cur);

        frames.push({
          name: `t${t}`,
          data: [{
            x: cur.x,
            y: cur.y,
            mode: 'markers',
            type: 'scatter',
            marker: { size: 10, color: t, colorscale: 'Viridis' },
            hovertemplate: 'x=%{x:.2f}<br>y=%{y:.2f}<extra>t=' + t + '</extra>'
          }],
          layout: {
            title: { text: `Points qui varient — étape t=${t}` }
          }
        });
      }
      return frames;
    }

    // Initialisation
    const initial = initPoints(N, spread);
    const frames = makeFrames(initial, T);

    // Trace initial (frame t=0)
    const data = [{
      x: frames[0].data[0].x,
      y: frames[0].data[0].y,
      mode: 'markers',
      type: 'scatter',
      marker: { size: 10, color: 0, colorscale: 'Viridis' },
      hovertemplate: 'x=%{x:.2f}<br>y=%{y:.2f}<extra>t=0</extra>'
    }];

    // Slider Plotly relié aux frames
    const layout = {
      title: { text: 'Points qui varient — étape t=0' },
      xaxis: { zeroline: false, range: [-spread, spread] },
      yaxis: { zeroline: false, range: [-spread, spread] },
      margin: { t: 50, r: 20, b: 40, l: 50 },
      sliders: [{
        active: 0,
        currentvalue: {
          prefix: 'Étape: ',
          xanchor: 'right',
          font: { size: 14 }
        },
        steps: frames.map((f, idx) => ({
          label: `${idx}`,
          method: 'animate',
          args: [[f.name], {
            mode: 'immediate',
            transition: { duration: 0 },
            frame: { duration: 0, redraw: true }
          }]
        }))
      }],
      updatemenus: [{
        type: 'buttons',
        showactive: false,
        x: 0.05, y: 1.15,
        buttons: [
          {
            label: '▶︎ Play',
            method: 'animate',
            args: [null, {
              fromcurrent: true,
              frame: { duration: 200, redraw: true },
              transition: { duration: 0 }
            }]
          },
          {
            label: '⏹ Pause',
            method: 'animate',
            args: [[null], {
              mode: 'immediate',
              frame: { duration: 0, redraw: false },
              transition: { duration: 0 }
            }]
          }
        ]
      }]
    };

    Plotly.newPlot('chart', data, layout).then(() => {
      Plotly.addFrames('chart', frames);
    });
  </script>
</body>
</html>
