
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Plotly 3.3 — Slider avec steps (sans frames)</title>
  <!-- Plotly.js v3.3 -->
  <script src="https://cdn.plot.ly/plotly-3.3.0.min.js"></script>
  <style>
    body { font-family: system-ui, sans-serif; margin: 0; padding: 20px; }
  </style>
</head>
<body>
  <div id="chart" style="width: 100%; height: 600px;"></div>

  <script>
    // --- Paramètres ---
    const N = 40;        // nombre de points
    const T = 20;        // nombre d'étapes (slider)
    const spread = 10;   // étendue initiale

    // Génère une population de points initiale
    function initPoints(n, spread = 10) {
      const x = [], y = [];
      for (let i = 0; i < n; i++) {
        x.push((Math.random() - 0.5) * spread);
        y.push((Math.random() - 0.5) * spread);
      }
      return { x, y };
    }

    // Fait évoluer les points légèrement (random walk déterministe pour une démo stable)
    function evolve(base, t, stepSize = 0.7) {
      const x = [], y = [];
      for (let i = 0; i < base.x.length; i++) {
        let xi = base.x[i], yi = base.y[i];
        // applique t "pas" avec une pseudo-graine
        for (let k = 0; k < t; k++) {
          xi += (Math.sin(i*13.37 + k*0.91) - 0.5) * stepSize;
          yi += (Math.cos(i*7.77  + k*1.23) - 0.5) * stepSize;
        }
        x.push(xi); y.push(yi);
      }
      return { x, y };
    }

    // Pré-calcul de toutes les étapes (sans frames Plotly)
    const base = initPoints(N, spread);
    const series = Array.from({ length: T }, (_, t) => evolve(base, t));

    // Trace initial (t=0)
    const data = [{
      x: series[0].x,
      y: series[0].y,
      mode: 'markers',
      type: 'scatter',
      marker: { size: 10, color: 0, colorscale: 'Viridis' },
      hovertemplate: 'x=%{x:.2f}<br>y=%{y:.2f}<extra>t=0</extra>'
    }];

    // Construction des steps du slider (méthode 'update')
    const steps = series.map((s, idx) => ({
      label: String(idx),
      method: 'update',
      args: [
        // 1) Mise à jour des données du trace 0 (x/y)
        { x: [s.x], y: [s.y], 'marker.color': [idx] },
        // 2) Mise à jour du layout (titre)
        { title: `Points qui varient — étape t=${idx}` }
      ]
    }));

    // Slider dans le layout (sans frames)
    const layout = {
      title: { text: 'Points qui varient — étape t=0' },
      xaxis: { zeroline: false, range: [-spread, spread] },
      yaxis: { zeroline: false, range: [-spread, spread] },
      margin: { t: 50, r: 20, b: 40, l: 50 },
      sliders: [{
        active: 0,
        currentvalue: {
          prefix: 'Étape: ',
          xanchor: 'right',
          font: { size: 14 }
        },
        transition: { duration: 0, easing: 'linear' }, // interaction fluide
        steps
      }]
    };

    Plotly.newPlot('chart', data, layout);
  </script>
</body>
</html>
